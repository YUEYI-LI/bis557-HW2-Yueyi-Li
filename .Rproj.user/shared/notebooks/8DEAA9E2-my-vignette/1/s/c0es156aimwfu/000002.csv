"0","# ridge functions "
"0","ridge <- function(X, y, lambda_vals) {"
"0","  # scale the independent variables"
"0","  X <- scale(X)"
"0","  svd_obj <- svd(X)"
"0","  U <- svd_obj$u"
"0","  V <- svd_obj$v"
"0","  d <- svd_obj$d"
"0","  ridge_beta <- matrix(NA_real_, nrow = length(lambda_vals), ncol = ncol(X))"
"0","  for (i in 1 : length(lambda_vals)) {"
"0","    D <- diag(d / (d^2 + lambda_vals[i]))"
"0","    ridge_beta[i,] <- V %*% D %*% t(U) %*% y"
"0","  }"
"0","  ridge_beta"
"0","}"
"0","opt_ridge <- function (X, y, lambda_vals){"
"0","  set.seed(123)"
"0","  # scale the independent variables"
"0","  X <- scale(X)"
"0","  # shuffle X and y"
"0","  ind <- sample(nrow(X), nrow(X), replace = F)"
"0","  X <- X[ind,]"
"0","  y <- y[ind]"
"0","  error <- rep(0, length(lambda_vals))"
"0","  folds <- as.numeric(cut(1:nrow(X), 5))"
"0","  for (j in 1: length(lambda_vals)) {"
"0","    for (i in 1:5){"
"0","      X_train <- X[folds != i, ]"
"0","      y_train <- y[folds != i]"
"0","      X_test <- X[folds == i, ]"
"0","      y_test <- y[folds == i]"
"0","      svd_obj <- svd(X_train)"
"0","      U <- svd_obj$u"
"0","      V <- svd_obj$v"
"0","      d <- svd_obj$d"
"0","      D <- diag(d / (d^2 + lambda_vals[j]))"
"0","      ridge_beta <- V %*% D %*% t(U) %*% y_train"
"0","      pred <- as.matrix(X_test) %*% ridge_beta"
"0","      error[j] <- error[j] + sum(folds==i)/nrow(X) * mean((pred - y_test)^2)"
"0","    }"
"0","  }"
"0","  plot(lambda_vals,error)"
"0","  lambda_vals[which.min(error)]"
"0","}"
